有一个世界坐标，然后要放置一台摄像机，还要放置物体

物体好说，物体由点、face 定义，就是空间坐标

但是照相机不仅有一个空间坐标（表示其位置），还有一个相机姿态

相机位置用一个空间中的点 C 来表示

相机姿态的确定还需要：

1.相机观察点的坐标 $P_{ref}$，注意是相机观察点的坐标，不是向量

2.相机的“向上”向量 V，upper direction

这两个也好理解，用照相机照相的时候，相机位置（C）确定了，在照哪里（$P_{ref}$）也确定了，如果再能确定 upper vector，也就是机顶闪光灯指着哪里，相机姿态就唯一确定了

所以要确定一个相机姿态，用到两个空间点和一个向量

分别是 C， $P_{ref}​$ ，以及 V

然后来定义“相机坐标”，它通过三个“在世界坐标中的单位向量”来指定，作为相机坐标的“基”

N 向量：即为从 C 到$P_{ref}$的向量单位化以后的单位向量 $N = \frac{P_{ref} - C}{|P_{ref} - C|} $

U 向量：此时 N 向量和 V 向量形成平面的法向量 $U = \frac{N  \times V}{|N  \times V|}$

V = U x N

![creen Shot 2018-03-19 at 11.01.19 P](/Users/Cancel/Course/gitbooks/knowledgeTree/assets/Screen Shot 2018-03-19 at 11.01.19 PM.png)

 为什么要多此一举求个 V 呢，因为刚开始的 V’ 很难保证和 N 是垂直的，或者说并不要求 V‘ 和 N 是垂直的，只是用它门来确定一个面就好



接下来把物体的所有的点从世界坐标转到相机坐标，因为相机坐标的基就是 N,V,U，三个世界坐标的向量，所以只要数学学的好，很轻松的就可以转换过来

为了使得平移矩阵可以换旋转等线性变换相乘，采用齐次坐标系得到耳熟能详的 RT 矩阵的乘积，也就是每个点乘以 RT 矩阵以后，就得到了在相机坐标中的点

![creen Shot 2018-03-19 at 11.16.52 P](/Users/Cancel/Course/gitbooks/knowledgeTree/assets/Screen Shot 2018-03-19 at 11.16.52 PM.png)

### Back-face culling

始终操作的对象都是点，面只是点的集合，所以对面的描述保持不变

要确定哪些是“back face”，只要看相机到面上任意一点的连线和面法向量的关系就行了

#### 变换

接下来，要做的事，确定视角，然后把视角内的物体**压缩**到一个“归一化”空间（第一版代码并没有做确定视角的工作）其实可能不是压缩，近大远小嘛

视角可以这样来定义，焦平面到相机距离为 d，也就是成像的那个平面，归一化的那个值

成像平面的宽度和高度，这里假设屏幕是一个正方形，由于相机看的方向正对相机坐标的z 轴，我们把这个高度的一半长度定为 h，也就是说这个正方形的成像平面由四个 h*h 的小正方形组成

![creen Shot 2018-03-19 at 11.30.35 P](/Users/Cancel/Course/gitbooks/knowledgeTree/assets/Screen Shot 2018-03-19 at 11.30.35 PM.png)

d 和 h

其实这里好像用冗余，完全可以归一化 d，把 d 变成1，只用 h 来确定视角岂不是更方便？再往下看 d 还有一个作用就是 near clipping plan， z 值比 d 小的就算在视野内也不渲染了，这样也好理解，都跑到成像平面后面去了，就不成像了

再确定一个 f，z 值比这个 f 大的值，也不成像了，这样有利于渲染效率

（此时应该思考，如何通过这个 d 和 f  物体跑出视角的物体，因为有可能一个面部分跑出视角）

这个变换要做的事情，是把刚才这个“视角”里面的空间变成一个“归一化”的空间

这个归一化的空间很好理解：**x 和 y 都在[-1,1]之间，z 在[0,1]之间**

这个空间将是我们渲染的关键点所在，因为这个空间即包含了三维物体的投影信息，又包括了点的深度信息

用矩阵变换来表示这个归一化的过程：

![creen Shot 2018-03-19 at 11.39.21 P](/Users/Cancel/Course/gitbooks/knowledgeTree/assets/Screen Shot 2018-03-19 at 11.39.21 PM.png)

相机世界中的点坐标的齐次坐标表示，乘以这个矩阵，就得到了归一化空间里面的齐次坐标，X, Y, Z,分别除以 W 就得到了三维空间中的坐标

现在回到刚才的问题，什么时候决定视角呢，是归一化转换的时候就不转化他们吗？并不是因为前面也提到如果一个面有一个点不在视角里面但是其他点还在，我们势必还要用到这个点的信息所以应该是渲染的时候，什么时候会出现问题，我们什么时候解决它

考虑在扫描线算法里解决它好像有点难，想到一个解决办法是把这个点转换成两个和归一化空间边界的交点，这样似乎有机会处理好这个问题